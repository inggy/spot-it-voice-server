(this["webpackJsonpspot-it-client"]=this["webpackJsonpspot-it-client"]||[]).push([[0],{35:function(e,t,a){e.exports=a(72)},40:function(e,t,a){},59:function(e,t){},71:function(e,t,a){},72:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(31),o=a.n(r),s=(a(40),a(7)),l=a(0),h=a(33),c=(a(71),function(e){var t=Object(n.useState)(""),a=Object(s.a)(t,2),r=a[0],o=a[1],l=Object(n.useState)(""),h=Object(s.a)(l,2),c=h[0],d=h[1];return i.a.createElement("form",{onSubmit:function(t){return t.preventDefault(),e.handleSubmit(r,c),!1}},i.a.createElement("label",{htmlFor:"roomName"},"Room name"),i.a.createElement("input",{name:"roomName",value:r,onChange:function(e){return o(e.target.value)}}),i.a.createElement("label",{htmlFor:"nickName"},"Your name"),i.a.createElement("input",{name:"nickName",value:c,onChange:function(e){return d(e.target.value)}}),i.a.createElement("button",{type:"submit",disabled:""===r||""===c},"Join"))}),d=a(2),u=a(3),f=function(){function e(t){Object(d.a)(this,e),this.app=void 0,this.scenes=void 0,this.current="",this.app=t,this.scenes={}}return Object(u.a)(e,[{key:"getCurrentScene",value:function(){return this.current}},{key:"addScene",value:function(e,t){this.scenes[e]=t}},{key:"switch",value:function(e){var t=this.scenes[this.current];if(t&&this.app.stage.removeChild(t),this.scenes.hasOwnProperty(e)){this.current=e;var a=this.scenes[e];a&&(a.hasRun||(a.init(),a.hasRun=!0),this.app.stage.addChild(a))}}}]),e}(),y=a(5),m=a(4),b=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(e,n){var i;return Object(d.a)(this,a),(i=t.call(this)).app=void 0,i.hasRun=!1,i.room=void 0,i.app=e,i.room=n,i}return Object(u.a)(a,[{key:"init",value:function(){}}]),a}(l.b),v=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(e,n,i){var r;Object(d.a)(this,a),(r=t.call(this)).clickCallback=null;var o=new l.f(e,i),s=new l.c,h=o.width+2*n.padding,c=o.height+2*n.padding;return s.lineStyle(n.borderWidth,n.borderColor,1,0),s.beginFill(n.fillColor),s.drawRoundedRect(Math.floor(-h/2),0,h,c,n.radius),s.endFill(),o.x=Math.floor(-o.width/2),o.y=Math.floor(n.padding),r.addChild(s),r.addChild(o),r.interactive=!0,r.buttonMode=!0,r.on("pointerdown",(function(){r.clickCallback&&r.clickCallback()})),r}return Object(u.a)(a,[{key:"onClick",value:function(e){this.clickCallback=e}},{key:"setEnabled",value:function(e){e?(this.interactive=!0,this.buttonMode=!0,this.alpha=1):(this.interactive=!1,this.buttonMode=!1,this.alpha=.5)}}]),a}(l.b);function p(e){e.send("sitDown")}function C(e){e.send("standUp")}function w(e){e.send("startGame")}function g(e){e.send("returnLobby")}var k=function(){function e(){Object(d.a)(this,e),this.callbacks=[]}return Object(u.a)(e,[{key:"addListener",value:function(e){this.callbacks.push(e)}},{key:"invokeCallbacks",value:function(e){this.callbacks.forEach((function(t){return t(e)}))}}]),e}(),L=new WeakMap;var O=function(e,t){e.onChange||(L.set(e,new k),e.onChange=function(t){return function(e,t){var a;null===(a=L.get(e))||void 0===a||a.invokeCallbacks(t)}(e,t)});var a=L.get(e);a&&a.addListener(t)};function S(e){return e.host}function j(e,t){return S(e)===t}function I(e,t){return!!e.players[t]}function E(e,t){return e.players[t].name}var x={HEADING_1:new l.g({fontFamily:"Comic Sans MS",fontSize:36}),HEADING_2:new l.g({fontFamily:"Comic Sans MS",fontSize:24}),default:new l.g({fontFamily:"Comic Sans MS",fontSize:16})},G={default:{padding:10,borderColor:0,borderWidth:3,fillColor:16777215,radius:8},primary:{padding:10,borderColor:0,borderWidth:3,fillColor:3525722,radius:8}},B=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).playerListContainer=new l.b,e.spectatorListContainer=new l.b,e.sitDownButton=new v("Play",G.default,x.HEADING_2),e.standUpButton=new v("Spectate",G.default,x.HEADING_2),e.startGameButton=new v("Start Game",G.primary,x.HEADING_1),e.sitDown=function(){p(e.room)},e.standUp=function(){C(e.room)},e.startGame=function(){w(e.room)},e}return Object(u.a)(a,[{key:"init",value:function(){var e=this;O(this.room.state,(function(t){t.forEach((function(t){switch(t.field){case"host":case"players":e.renderPlayerList(),e.updateButtonStates();break;case"spectators":e.renderSpectatorList()}}))}));var t=new l.f("Players",x.HEADING_1);t.x=1*this.app.renderer.width/3-t.width/2,t.y=100,this.addChild(t);var a=new l.f("Spectators",x.HEADING_1);a.x=2*this.app.renderer.width/3-a.width/2,a.y=100,this.addChild(a),this.playerListContainer.x=t.x+t.width/2,this.playerListContainer.y=t.y+t.height+15,this.addChild(this.playerListContainer),this.spectatorListContainer.x=a.x+a.width/2,this.spectatorListContainer.y=this.playerListContainer.y,this.addChild(this.spectatorListContainer),this.renderPlayerList(),this.renderSpectatorList(),this.sitDownButton.x=Math.floor(this.app.renderer.width/2),this.sitDownButton.y=470,this.sitDownButton.onClick(this.sitDown),this.standUpButton.x=Math.floor(this.app.renderer.width/2),this.standUpButton.y=470,this.standUpButton.onClick(this.standUp),this.startGameButton.x=Math.floor(this.app.renderer.width/2),this.startGameButton.y=530,this.startGameButton.onClick(this.startGame),this.addChild(this.sitDownButton),this.addChild(this.standUpButton),this.updateButtonStates()}},{key:"renderPlayerList",value:function(){var e,t=this;this.playerListContainer.removeChildren(),(e=this.room.state,Object.values(e.players)).forEach((function(e,a){var n=new l.f(e.name+(j(t.room.state,e.id)?" [Host]":""),x.HEADING_2);n.x=-n.width/2,n.y=30*a,t.playerListContainer.addChild(n)}))}},{key:"renderSpectatorList",value:function(){var e,t=this;this.spectatorListContainer.removeChildren(),(e=this.room.state,Object.values(e.spectators)).forEach((function(e,a){var n=new l.f(e.name,x.HEADING_2);n.x=-n.width/2,n.y=30*a,t.spectatorListContainer.addChild(n)}))}},{key:"updateButtonStates",value:function(){var e=I(this.room.state,this.room.sessionId);this.sitDownButton.setEnabled(!e),this.sitDownButton.visible=!e,this.standUpButton.setEnabled(e),this.standUpButton.visible=e,j(this.room.state,this.room.sessionId)?this.addChild(this.startGameButton):this.removeChild(this.startGameButton)}}]),a}(b);function D(e){return e.gameState.phase}function _(e){return e.gameState.centerCardIndex}function M(e){return e.deck[_(e)]}function R(e,t){return e.gameState.winner===t}function P(e,t){return e.gameState.playerHandIndex[t]}function N(e,t,a){var n=H(e,t);return n?n.length-a:null}function H(e,t){var a;return null===(a=e.gameState.hands[t])||void 0===a?void 0:a.cards}function A(e,t,a){var n=H(e,t)[a];return e.deck[n]}var z=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(e,n){var i;return Object(d.a)(this,a),(i=t.call(this)).playerTextMapping={},i.playerScoreMapping={},i.renderPlayerList=function(e){i.removeChildren(),i.playerTextMapping={},i.playerScoreMapping={};var t=0;Object.keys(e.players).forEach((function(a){var n=new l.f(e.players[a].name,x.HEADING_2);n.x=0,n.y=65*t,i.addChild(n),i.playerTextMapping[a]=n;var r,o=function(e,t){if(R(e,t))return 0;var a=P(e,t),n=H(e,t);return null!=a&&n?n.length-a:0}(e,a),s=new l.f("".concat(r=o," card").concat(r>1?"s":""),x.HEADING_2);s.x=20,s.y=n.y+30,i.addChild(s),i.playerScoreMapping[a]=s,t++}))},n.onStateChange(i.renderPlayerList),i.renderPlayerList(n.state),i}return a}(l.b);var F=a(34),T={spriteKey:window.__PUBLIC_URL__+"/assets/spritesheet.json",getSpriteSheet:function(){return l.d.shared.resources[T.spriteKey].spritesheet}},U=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(e,n){var i,r,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(d.a)(this,a),(r=t.call(this))._clickCallback=[],r.disableOverlay=new l.c,r.errorOverlay=new l.c;var s=new l.c;s.lineStyle(2,10066329,1),s.beginFill(16777215,1),s.drawCircle(0,0,e/2),s.endFill(),r.addChild(s),r.disableOverlay.beginFill(16777215,.5),r.disableOverlay.drawCircle(0,0,e/2),r.disableOverlay.endFill(),r.errorOverlay.lineStyle(4,14876672,1),r.errorOverlay.drawCircle(0,0,e/2);var h=T.getSpriteSheet(),c=2*Math.PI/(n.symbols.length-1),u=n.rotationOffset*(2*Math.PI),f=e/3.75,y=n.symbols.map((function(t,a){var i=(t+"").padStart(2,"0")+".png",s=new l.e(h.textures[i]),d=e/4,y=0===a?0:(f+e/9*n.offset[a])*Math.cos(u+a*c),m=0===a?0:(f+e/9*n.offset[a])*Math.sin(u+a*c);return s.x=y,s.y=m,s.width=d*n.scale[a],s.height=d*n.scale[a],s.anchor.set(.5),s.rotation=n.rotation[a]*(2*Math.PI),o&&(s.interactive=!0,s.buttonMode=!0,s.on("pointerdown",(function(e){r._clickCallback.forEach((function(e){return e(t)}))}))),s}));return(i=r).addChild.apply(i,Object(F.a)(y)),r}return Object(u.a)(a,[{key:"disable",value:function(){this.removeChild(this.errorOverlay);var e=new l.h.BlurFilter(5);this.filters=[e],this.addChild(this.disableOverlay)}},{key:"showError",value:function(){this.addChild(this.errorOverlay)}},{key:"hideError",value:function(){this.removeChild(this.errorOverlay)}},{key:"clear",value:function(){this.filters=[],this.removeChildren()}},{key:"subscribeClick",value:function(e){this._clickCallback.push(e)}}]),a}(l.b),W=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(e,n){var i;Object(d.a)(this,a),(i=t.call(this)).curCard=null,i.size=0,i.schema=void 0,i.playedByLabel=void 0,i.schema=e,i.size=n;var r=new l.f("Center Card",x.HEADING_1);return r.x=-Math.floor(r.width/2),r.y=-(Math.floor(i.size/2)+85),i.playedByLabel=new l.f("",x.HEADING_2),i.playedByLabel.y=-(Math.floor(i.size/2)+40),O(e.gameState,(function(t){t.forEach((function(t){"centerCardIndex"===t.field&&i.drawNewCard(M(e),function(e){var t=_(e),a=Object.keys(e.gameState.hands).find((function(a){return H(e,a).includes(t)}));return a?E(e,a):null}(e))}))})),i.drawNewCard(M(e),null),i.addChild(r),i.addChild(i.playedByLabel),i}return Object(u.a)(a,[{key:"drawNewCard",value:function(e,t){this.curCard&&(this.removeChild(this.curCard),this.curCard.destroy({children:!0})),t?(this.playedByLabel.text="played by ".concat(t),this.playedByLabel.x=-Math.floor(this.playedByLabel.width/2)):this.playedByLabel.text="",this.curCard=new U(this.size,e),this.addChild(this.curCard)}},{key:"reset",value:function(){this.curCard&&this.removeChild(this.curCard),this.curCard=null}},{key:"prepareForGame",value:function(){this.drawNewCard(M(this.schema),null)}}]),a}(l.b),J=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(e,n,i){var r;Object(d.a)(this,a),(r=t.call(this)).curCard=null,r.size=0,r.playerId="",r.isPlayer=!0,r.wrongPlayTimeout=null,r.playCardCallback=void 0,r.schema=void 0,r.cardsRemainingLabel=void 0,r._onLocalTimeoutChange=function(e,t){if(t===r.playerId){var a,n,i=Date.now();if(r.wrongPlayTimeout)clearTimeout(r.wrongPlayTimeout),r.wrongPlayTimeout=null,null===(a=r.curCard)||void 0===a||a.hideError();if(i<e)null===(n=r.curCard)||void 0===n||n.showError(),r.wrongPlayTimeout=setTimeout((function(){var e;null===(e=r.curCard)||void 0===e||e.hideError(),r.wrongPlayTimeout=null}),e-i)}},r.playCardCallback=i,r.schema=e,r.size=n;var o=new l.f("Your Hand",x.HEADING_1);return o.x=-Math.floor(o.width/2),o.y=-(Math.floor(r.size/2)+85),r.cardsRemainingLabel=new l.f("",x.HEADING_2),r.cardsRemainingLabel.y=-(Math.floor(r.size/2)+40),r.addChild(o),r.addChild(r.cardsRemainingLabel),r}return Object(u.a)(a,[{key:"drawNewCard",value:function(e){var t=this;this.curCard&&(this.removeChild(this.curCard),this.curCard.destroy({children:!0})),this.curCard=new U(this.size,e,this.isPlayer),this.curCard.subscribeClick((function(e){t.playCardCallback(e)})),this.addChild(this.curCard)}},{key:"updateCardsRemaining",value:function(e){null==e?this.cardsRemainingLabel.text="":(this.cardsRemainingLabel.text=e+" card"+(1===e?"":"s")+" remaining",this.cardsRemainingLabel.x=-Math.floor(this.cardsRemainingLabel.width/2))}},{key:"endGameAsWinner",value:function(){var e;null===(e=this.curCard)||void 0===e||e.clear(),this.updateCardsRemaining(0),this._unsubscribeFromPlayerDataChange()}},{key:"endGame",value:function(){var e;null===(e=this.curCard)||void 0===e||e.disable(),this._unsubscribeFromPlayerDataChange()}},{key:"prepareForGame",value:function(e,t){this.playerId=e,this.isPlayer=t,this._subscribeToPlayerDataChange()}},{key:"reset",value:function(){this.updateCardsRemaining(null),this.curCard&&this.removeChild(this.curCard),this.curCard=null}},{key:"startGame",value:function(){this.drawNewCard(A(this.schema,this.playerId,0)),this.updateCardsRemaining(N(this.schema,this.playerId,0))}},{key:"_subscribeToPlayerDataChange",value:function(){var e=this;console.log("subscribe"),this.schema.gameState.playerHandIndex.onChange=function(t,a){a===e.playerId&&(e.drawNewCard(A(e.schema,e.playerId,t)),e.updateCardsRemaining(N(e.schema,e.playerId,t)))},this.schema.gameState.localTimeouts.onChange=this._onLocalTimeoutChange}},{key:"_unsubscribeFromPlayerDataChange",value:function(){console.log("unsubscribe"),this.schema.gameState.playerHandIndex.onChange=function(){},this.schema.gameState.localTimeouts.onChange=function(){}}}]),a}(l.b),Y=function(e){Object(y.a)(a,e);var t=Object(m.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).toLobbyButton=new v("Back to lobby",G.default,x.HEADING_2),e.getReadyLabel=new l.f("Get Ready!",x.HEADING_1),e.handContainer=void 0,e.deckContainer=void 0,e.effectivePlayerId="",e.gameInitialized=!1,e.backToLobby=function(){g(e.room)},e}return Object(u.a)(a,[{key:"init",value:function(){var e=this,t=new z(this.room.sessionId,this.room);t.x=10,t.y=96,this.addChild(t);var a=new W(this.room.state,370);a.x=415,a.y=370;var n=new J(this.room.state,370,(function(t){return function(e,t,a){e.send("selectSymbol",{symbol:t,centerCardIndex:a,localTime:Date.now()})}(e.room,t,_(e.room.state))}));n.x=850,n.y=370,this.addChild(a),this.addChild(n),this.toLobbyButton.x=630,this.toLobbyButton.y=570,this.toLobbyButton.onClick(this.backToLobby),this.getReadyLabel.x=Math.floor(n.x-this.getReadyLabel.width/2),this.getReadyLabel.y=Math.floor(n.y-this.getReadyLabel.height/2),O(this.room.state,(function(t){t.forEach((function(t){"mode"===t.field&&"lobby"===t.value&&(e.removeChild(e.toLobbyButton),a.reset(),n.reset())}))})),O(this.room.state.gameState,(function(t){t.forEach((function(t){"phase"===t.field&&e.handleGamePhaseChange(t.value)}))})),this.handContainer=n,this.deckContainer=a,this.handleGamePhaseChange(D(this.room.state))}},{key:"initializeDecks",value:function(){var e=I(this.room.state,this.room.sessionId);this.effectivePlayerId=e?this.room.sessionId:S(this.room.state),this.deckContainer.prepareForGame(),this.handContainer.prepareForGame(this.effectivePlayerId,e),this.gameInitialized=!0}},{key:"showHandLabel",value:function(e){e&&(this.getReadyLabel.text=e,this.getReadyLabel.x=Math.floor(this.handContainer.x-this.getReadyLabel.width/2)),this.addChild(this.getReadyLabel)}},{key:"handleGamePhaseChange",value:function(e){switch(e){case"pregame":this.initializeDecks(),this.showHandLabel("Get Ready!");break;case"in_progress":this.gameInitialized||this.initializeDecks(),this.handContainer.startGame(),this.removeChild(this.getReadyLabel);break;case"endgame":if(R(this.room.state,this.effectivePlayerId))this.showHandLabel("You Win!"),this.handContainer.endGameAsWinner();else{var t=E(a=this.room.state,a.gameState.winner);this.showHandLabel("".concat(t," wins")),this.handContainer.endGame()}j(this.room.state,this.room.sessionId)&&this.addChild(this.toLobbyButton);break;default:this.removeChild(this.getReadyLabel),this.gameInitialized=!1}var a}}]),a}(b),K=window.document.location,$=K.host.replace(/:.*/,""),q="ws://localhost:2567";$.indexOf("localhost")<0&&(q=K.protocol.replace("http","ws")+"//"+$+(K.port?":"+K.port:""));var Q=new h.Client(q);var V=function(){var e=Object(n.useRef)(null),t=Object(n.useState)(!1),a=Object(s.a)(t,2),r=a[0],o=a[1],h=Object(n.useState)(),d=Object(s.a)(h,2),u=d[0],y=d[1],m=Object(n.useState)(!1),b=Object(s.a)(m,2),v=b[0],p=b[1];return Object(n.useEffect)((function(){l.d.shared.add(window.__PUBLIC_URL__+"/assets/spritesheet.json").load((function(){var t=new l.a({backgroundColor:16777215,width:1100,height:630});null!=e.current&&(e.current.prepend(t.view),y(t),o(!0))}))}),[]),i.a.createElement("div",{className:"App"},i.a.createElement("div",{id:"joinGameForm"},r&&!v&&i.a.createElement(c,{handleSubmit:function(e,t){Q.joinOrCreate("spot-it",{roomName:e,name:t}).then((function(t){var a=u,n=new f(a);n.addScene("lobby",new B(a,t)),n.addScene("game",new Y(a,t));var i=new l.f("Room: ".concat(e),x.HEADING_2);i.x=10,i.y=10,a.stage.addChild(i),O(t.state,(function(e){e.forEach((function(e){switch(e.field){case"mode":e.value!==n.getCurrentScene()&&n.switch(e.value)}}))})),p(!0)}))}})),i.a.createElement("div",{ref:e}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(V,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[35,1,2]]]);
//# sourceMappingURL=main.8b8a966c.chunk.js.map